import React, { useState } from 'react';
import { 
  Package, 
  LayoutDashboard, 
  FileText, 
  LogOut, 
  CheckCircle, 
  XCircle, 
  Plus, 
  User, 
  Search, 
  Menu,
  Clock,
  Send,
  Archive,
  Info,
  Edit3
} from 'lucide-react';

// --- Konfigurasi Warna ---
const COLORS = {
  primary: '#1594a2',   // Biru Laut (Tombol, Header Card)
  secondary: '#b6d250', // Hijau Pupus (Aksen, Badge Pending)
  dark: '#0c616a',      // Teal Gelap (Sidebar, Footer)
  light: '#f3f4f6',     // Background abu-abu
  white: '#ffffff',
  warning: '#f59e0b',
  danger: '#ef4444'
};

// --- Mock Data Awal (Sesuai Struktur Excel) ---
const INITIAL_BOXES = [
  {
    id: 1,
    tanggal: '2023-10-25',
    divisi: 'DHPU',
    asal_arsip: 'Gudang Lt. 2',
    dokumen: [
        { no: 1, nama: 'Laporan Keuangan Q1', periode: 'Jan 2023' },
        { no: 2, nama: 'Laporan Keuangan Q2', periode: 'Apr 2023' },
        { no: 3, nama: 'Audit Internal', periode: 'Jun 2023' },
        { no: 4, nama: 'Pajak Tahunan', periode: '2022' },
        { no: 5, nama: 'Rekap Absensi', periode: '2023' }
    ],
    jumlah_bantex: 5,
    keterangan: 'Box Penuh',
    status: 'approved',
    nomor_kotak: 'RFID-998821', // Diisi Admin
    admin_note: ''
  },
  {
    id: 2,
    tanggal: '2023-10-26',
    divisi: 'DSPN',
    asal_arsip: 'Ruang Meeting',
    dokumen: [
        { no: 1, nama: 'Project Alpha Docs', periode: 'Okt 2023' },
        { no: 2, nama: 'MoU Vendor', periode: 'Sep 2023' }
    ],
    jumlah_bantex: 2,
    keterangan: 'Box Sementara',
    status: 'pending',
    nomor_kotak: null, // Belum diisi
    admin_note: ''
  }
];

export default function SiasApp() {
  // --- State Aplikasi ---
  const [view, setView] = useState('login'); 
  const [userRole, setUserRole] = useState(null); 
  const [boxes, setBoxes] = useState(INITIAL_BOXES);
  const [username, setUsername] = useState('');
  const [password, setPassword] = useState('');
  const [isSidebarOpen, setIsSidebarOpen] = useState(true);

  // --- State Form Input Box ---
  const [formData, setFormData] = useState({
    divisi: '',
    asal_arsip: '',
    keterangan: '',
    jumlah_bantex: 0
  });

  // State untuk Dynamic Rows (Isi Dokumen dalam Box)
  const [docItems, setDocItems] = useState([
    { no: 1, nama: '', periode: '' }
  ]);

  // --- Fungsi Logika ---

  const handleLogin = (e) => {
    e.preventDefault();
    if (username === 'administrator' && password === '123') {
      setUserRole('admin');
      setView('dashboard');
    } else if (username === 'user') {
      setUserRole('user');
      setView('dashboard');
    } else {
      alert('Username atau Password salah! (Coba: administrator / 123)');
    }
  };

  const handleLogout = () => {
    setUserRole(null);
    setUsername('');
    setPassword('');
    setView('login');
    // Reset Form
    setFormData({ divisi: '', asal_arsip: '', keterangan: '', jumlah_bantex: 0 });
    setDocItems([{ no: 1, nama: '', periode: '' }]);
  };

  // -- Logika Form Dokumen --
  const handleDocChange = (index, field, value) => {
    const newDocs = [...docItems];
    newDocs[index][field] = value;
    setDocItems(newDocs);
  };

  const addDocRow = () => {
    setDocItems([...docItems, { no: docItems.length + 1, nama: '', periode: '' }]);
  };

  const removeDocRow = (index) => {
    if (docItems.length > 1) {
      const newDocs = docItems.filter((_, i) => i !== index).map((doc, i) => ({ ...doc, no: i + 1 }));
      setDocItems(newDocs);
    }
  };

  // Hitung jumlah bantex otomatis dari jumlah baris dokumen (asumsi 1 baris = 1 bantex/jenis)
  // Atau user bisa override jika 1 baris mewakili banyak bantex
  const calculatedBantex = docItems.length;

  // -- Submit Pengajuan Box --
  const handleSubmitBox = (e) => {
    e.preventDefault();
    
    // Validasi sederhana
    if (!formData.asal_arsip) {
      alert("Mohon isi Asal Arsip");
      return;
    }

    const newBox = {
      id: boxes.length + 1,
      tanggal: new Date().toISOString().split('T')[0],
      divisi: userRole === 'admin' ? 'Administrator' : formData.divisi || 'UMUM',
      asal_arsip: formData.asal_arsip,
      dokumen: docItems,
      jumlah_bantex: calculatedBantex,
      keterangan: formData.keterangan,
      status: 'pending',
      nomor_kotak: null, // Kosong saat submit, diisi Admin nanti
      admin_note: ''
    };

    setBoxes([newBox, ...boxes]);
    
    // Reset Form
    setFormData({ divisi: '', asal_arsip: '', keterangan: '', jumlah_bantex: 0 });
    setDocItems([{ no: 1, nama: '', periode: '' }]);
    
    setView('data-box');
    alert('Data Box berhasil diajukan. Menunggu Admin mengisi Nomor Kotak.');
  };

  // -- Admin Actions --
  const handleApprove = (id) => {
    // Admin harus input nomor kotak manual
    const inputNomor = prompt("Masukkan Nomor Kotak / RFID untuk Box ini:");
    
    if (inputNomor) {
      const updatedBoxes = boxes.map((box) => {
        if (box.id === id) {
          return {
            ...box,
            status: 'approved',
            nomor_kotak: inputNomor // Set manual dari Admin
          };
        }
        return box;
      });
      setBoxes(updatedBoxes);
    }
  };

  const handleReject = (id) => {
    const reason = prompt("Masukkan alasan penolakan (opsional):");
    if (reason === null) return; // Cancel

    const updatedBoxes = boxes.map((box) => 
      box.id === id ? { ...box, status: 'rejected', admin_note: reason } : box
    );
    setBoxes(updatedBoxes);
  };

  // --- Komponen UI ---

  const LoginScreen = () => (
    <div className="min-h-screen flex items-center justify-center bg-gray-100 font-sans">
      <div className="bg-white p-8 rounded-lg shadow-xl w-full max-w-md border-t-4" style={{ borderColor: COLORS.primary }}>
        <div className="text-center mb-8">
          <div className="mx-auto w-16 h-16 rounded-full flex items-center justify-center mb-4 text-white shadow-lg" style={{ backgroundColor: COLORS.dark }}>
            <Package size={32} />
          </div>
          <h1 className="text-2xl font-bold text-gray-800">Sistem Repository Arsip</h1>
          <p className="text-gray-500 text-sm mt-2">Masuk untuk mengelola Box & Bantex</p>
        </div>
        
        <form onSubmit={handleLogin} className="space-y-6">
          <div>
            <label className="block text-sm font-medium text-gray-700">Username</label>
            <input 
              type="text" 
              className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-[#1594a2]"
              value={username}
              onChange={(e) => setUsername(e.target.value)}
              placeholder="administrator / user"
            />
          </div>
          <div>
            <label className="block text-sm font-medium text-gray-700">Password</label>
            <input 
              type="password" 
              className="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-[#1594a2]"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              placeholder="123 / user"
            />
          </div>
          <button 
            type="submit" 
            className="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white hover:opacity-90 transition-opacity"
            style={{ backgroundColor: COLORS.primary }}
          >
            Login Sistem
          </button>
        </form>
        <div className="mt-4 text-center text-xs text-gray-400">
          Demo: Admin (administrator/123) | User (user/user)
        </div>
      </div>
    </div>
  );

  const Sidebar = () => (
    <div className={`fixed inset-y-0 left-0 z-30 w-64 transform transition-transform duration-300 ease-in-out ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'} md:translate-x-0 md:static md:inset-auto text-white shadow-2xl flex flex-col`} style={{ backgroundColor: COLORS.dark }}>
      <div className="flex items-center justify-center h-20 shadow-md" style={{ backgroundColor: 'rgba(0,0,0,0.2)' }}>
        <div className="flex items-center gap-2">
           <Archive size={28} color={COLORS.secondary} />
           <div>
             <h2 className="text-lg font-bold tracking-wider leading-none">INDOARSIP</h2>
             <span className="text-xs text-gray-300 tracking-widest">REPOSITORY</span>
           </div>
        </div>
      </div>
      
      <div className="p-4 flex-1">
        <div className="flex items-center gap-3 mb-8 p-3 rounded-lg bg-white bg-opacity-10 border border-white border-opacity-10">
          <div className="bg-white text-teal-800 p-2 rounded-full">
            <User size={20} />
          </div>
          <div>
            <p className="text-sm font-bold">{userRole === 'admin' ? 'Administrator' : 'Divisi User'}</p>
            <div className="flex items-center gap-1">
              <div className="w-2 h-2 rounded-full bg-green-400 animate-pulse"></div>
              <p className="text-xs text-gray-300">Online</p>
            </div>
          </div>
        </div>

        <nav className="space-y-2">
          <SidebarItem icon={<LayoutDashboard size={20}/>} label="Dashboard" active={view === 'dashboard'} onClick={() => setView('dashboard')} />
          <SidebarItem icon={<Plus size={20}/>} label="Input Box Baru" active={view === 'input-box'} onClick={() => setView('input-box')} />
          <SidebarItem icon={<Package size={20}/>} label="Data Box Arsip" active={view === 'data-box'} onClick={() => setView('data-box')} />
        </nav>
      </div>

      <div className="p-4 bg-black bg-opacity-20">
        <button onClick={handleLogout} className="flex items-center gap-2 w-full px-4 py-2 text-red-200 hover:text-white hover:bg-red-900/50 rounded-md transition-colors">
          <LogOut size={20} />
          <span>Keluar Sistem</span>
        </button>
      </div>
    </div>
  );

  const SidebarItem = ({ icon, label, active, onClick }) => (
    <button 
      onClick={onClick}
      className={`flex items-center gap-3 w-full px-4 py-3 text-sm font-medium rounded-md transition-all duration-200 border-l-4 ${
        active 
          ? 'bg-white bg-opacity-10 text-white border-[#b6d250]' 
          : 'border-transparent text-gray-400 hover:bg-white hover:bg-opacity-5 hover:text-white'
      }`}
    >
      {icon}
      <span>{label}</span>
    </button>
  );

  // --- View: Dashboard ---
  const DashboardView = () => {
    const pendingCount = boxes.filter(l => l.status === 'pending').length;
    const approvedCount = boxes.filter(l => l.status === 'approved').length;

    return (
      <div className="space-y-6 animate-in fade-in duration-500">
        <h2 className="text-2xl font-bold text-gray-800 border-b pb-2">Dashboard Overview</h2>
        
        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
          <StatCard title="Total Box Arsip" value={boxes.length} icon={<Package size={28}/>} color={COLORS.primary} />
          <StatCard title="Box Ter-Register (ACC)" value={approvedCount} icon={<CheckCircle size={28}/>} color={COLORS.secondary} />
          <StatCard title="Menunggu Nomor Kotak" value={pendingCount} icon={<Clock size={28}/>} color={COLORS.warning} />
        </div>

        <div className="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
          <div className="px-6 py-4 border-b border-gray-100 flex justify-between items-center bg-gray-50">
            <h3 className="font-semibold text-gray-700">Aktivitas Terbaru</h3>
            <button onClick={() => setView('data-box')} className="text-sm text-[#1594a2] hover:underline font-medium">Lihat Semua Data</button>
          </div>
          <div className="divide-y divide-gray-100">
            {boxes.slice(0, 3).map((box) => (
              <div key={box.id} className="p-4 flex items-center justify-between hover:bg-gray-50 transition-colors">
                <div className="flex items-center gap-4">
                  <div className={`p-2 rounded-full ${box.status === 'approved' ? 'bg-green-100 text-green-600' : 'bg-yellow-100 text-yellow-600'}`}>
                    {box.status === 'approved' ? <CheckCircle size={20}/> : <Clock size={20}/>}
                  </div>
                  <div>
                    <p className="font-bold text-gray-800">Box dari: {box.divisi}</p>
                    <p className="text-xs text-gray-500">Asal: {box.asal_arsip} â€¢ {box.tanggal}</p>
                  </div>
                </div>
                <div className="text-right">
                    <span className={`px-3 py-1 text-xs font-bold rounded-full ${
                    box.status === 'approved' ? 'bg-[#b6d250] text-white' : 
                    box.status === 'rejected' ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800'
                    }`}>
                    {box.status === 'approved' ? 'SUDAH ACC' : box.status === 'rejected' ? 'DITOLAK' : 'MENUNGGU ACC'}
                    </span>
                    {box.nomor_kotak && <p className="text-xs font-mono font-bold text-[#0c616a] mt-1">{box.nomor_kotak}</p>}
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    );
  };

  const StatCard = ({ title, value, icon, color }) => (
    <div className="bg-white p-6 rounded-xl shadow-sm border-l-4 transform transition-transform hover:-translate-y-1" style={{ borderLeftColor: color }}>
      <div className="flex items-center justify-between">
        <div>
          <p className="text-sm text-gray-500 mb-1 font-medium uppercase tracking-wide">{title}</p>
          <h3 className="text-4xl font-bold text-gray-800">{value}</h3>
        </div>
        <div className="p-4 rounded-full bg-opacity-10" style={{ backgroundColor: color, color: color }}>
          {icon} 
        </div>
      </div>
    </div>
  );

  // --- View: Input Box ---
  const InputBoxView = () => {
    const isBoxFull = calculatedBantex >= 5;

    return (
    <div className="max-w-5xl mx-auto animate-in slide-in-from-bottom-4 duration-500">
      <div className="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200">
        <div className="px-6 py-4 border-b border-gray-200 flex justify-between items-center" style={{ backgroundColor: COLORS.primary }}>
          <h2 className="text-lg font-bold text-white flex items-center gap-2">
            <Plus size={20} className="text-[#b6d250]" />
            Form Input Box & Bantex
          </h2>
          <span className="text-xs bg-white bg-opacity-20 text-white px-2 py-1 rounded">Divisi: {userRole === 'admin' ? 'Administrator' : formData.divisi || 'User Divisi'}</span>
        </div>
        
        <div className="p-8">
          <form onSubmit={handleSubmitBox} className="space-y-8">
            
            {/* Bagian Header Box */}
            <div className="bg-gray-50 p-5 rounded-lg border border-gray-200">
              <h3 className="text-sm font-bold text-[#0c616a] uppercase mb-4 border-b border-gray-200 pb-2">A. Informasi Box</h3>
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Divisi Pemilik</label>
                  <input 
                    type="text" 
                    value={userRole === 'user' ? 'Divisi Anda' : formData.divisi}
                    onChange={(e) => userRole === 'admin' && setFormData({...formData, divisi: e.target.value})}
                    disabled={userRole === 'user'}
                    className="w-full px-4 py-2 border border-gray-300 rounded-md bg-gray-100 text-gray-500"
                  />
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-1">Asal Arsip (Lokasi)</label>
                  <input 
                    type="text" 
                    required
                    value={formData.asal_arsip}
                    onChange={(e) => setFormData({...formData, asal_arsip: e.target.value})}
                    className="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#1594a2] focus:border-transparent"
                    placeholder="Contoh: Rak Gudang Lt. 2 / Lemari 3"
                  />
                </div>
                <div className="md:col-span-2">
                  <label className="block text-sm font-medium text-gray-700 mb-1">Keterangan Tambahan Box</label>
                  <input 
                    type="text" 
                    value={formData.keterangan}
                    onChange={(e) => setFormData({...formData, keterangan: e.target.value})}
                    className="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-[#1594a2] focus:border-transparent"
                    placeholder="Opsional: Keterangan isi box secara umum..."
                  />
                </div>
              </div>
            </div>

            {/* Bagian Detail Bantex */}
            <div>
              <div className="flex justify-between items-end mb-2 border-b border-gray-200 pb-2">
                 <h3 className="text-sm font-bold text-[#0c616a] uppercase">B. Isi Dokumen (Bantex)</h3>
                 <div className="flex items-center gap-2">
                    <span className={`text-xs font-bold px-2 py-1 rounded ${isBoxFull ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-700'}`}>
                        Total Bantex: {calculatedBantex} {isBoxFull ? '(Box Penuh)' : '(Belum Penuh)'}
                    </span>
                    <span className="text-xs text-gray-400">*Idealnya 1 Box = 5-6 Bantex</span>
                 </div>
              </div>
              
              <div className="bg-gray-50 rounded-lg border border-gray-200 overflow-hidden">
                <table className="min-w-full divide-y divide-gray-200">
                  <thead className="bg-gray-100">
                    <tr>
                      <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase w-12">No</th>
                      <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Nama Dokumen</th>
                      <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase w-40">Periode</th>
                      <th className="px-4 py-2 text-center text-xs font-medium text-gray-500 uppercase w-20">Aksi</th>
                    </tr>
                  </thead>
                  <tbody className="bg-white divide-y divide-gray-200">
                    {docItems.map((doc, index) => (
                      <tr key={index}>
                        <td className="px-4 py-2 text-sm text-gray-500 text-center">{doc.no}</td>
                        <td className="px-4 py-2">
                          <input 
                            type="text" 
                            required
                            value={doc.nama}
                            onChange={(e) => handleDocChange(index, 'nama', e.target.value)}
                            placeholder="Nama Dokumen / Bantex"
                            className="w-full border-0 border-b border-gray-200 focus:border-[#1594a2] focus:ring-0 text-sm px-0 bg-transparent"
                          />
                        </td>
                        <td className="px-4 py-2">
                           <input 
                            type="text" 
                            required
                            value={doc.periode}
                            onChange={(e) => handleDocChange(index, 'periode', e.target.value)}
                            placeholder="Tahun/Bulan"
                            className="w-full border-0 border-b border-gray-200 focus:border-[#1594a2] focus:ring-0 text-sm px-0 bg-transparent"
                          />
                        </td>
                        <td className="px-4 py-2 text-center">
                          {docItems.length > 1 && (
                            <button type="button" onClick={() => removeDocRow(index)} className="text-red-400 hover:text-red-600">
                              <XCircle size={16} />
                            </button>
                          )}
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
                <div className="p-2 bg-gray-100 border-t border-gray-200">
                  <button type="button" onClick={addDocRow} className="text-xs flex items-center gap-1 text-[#1594a2] font-bold hover:underline">
                    <Plus size={14} /> Tambah Baris Dokumen
                  </button>
                </div>
              </div>
            </div>

            {/* Info Box */}
            <div className="bg-blue-50 p-4 rounded-md border border-blue-100 flex gap-3">
              <Info className="text-blue-500 mt-0.5 flex-shrink-0" size={20} />
              <div className="text-sm text-blue-800">
                <p className="font-bold">Informasi Alur:</p>
                <ul className="list-disc ml-4 mt-1 space-y-1 text-xs">
                    <li>Isi semua dokumen yang ada di dalam box ini.</li>
                    <li>Jika sudah mencapai 5-6 bantex, box dianggap penuh dan siap diajukan.</li>
                    <li>Setelah klik "Ajukan Box", data akan dikirim ke Admin.</li>
                    <li><strong>Nomor Kotak / RFID</strong> akan muncul setelah Admin melakukan ACC.</li>
                </ul>
              </div>
            </div>

            <div className="flex justify-end pt-4">
              <button 
                type="submit" 
                className="flex items-center gap-2 px-8 py-3 text-white rounded-lg hover:shadow-lg transition-all transform hover:-translate-y-0.5 font-bold"
                style={{ backgroundColor: COLORS.secondary }}
              >
                <Send size={18} />
                Ajukan Box Sekarang
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  )};

  // --- View: Data Box ---
  const DataBoxView = () => (
    <div className="space-y-6 animate-in fade-in duration-500">
      <div className="flex justify-between items-center">
        <div>
           <h2 className="text-2xl font-bold text-gray-800">Data Box Arsip</h2>
           <p className="text-sm text-gray-500">Daftar semua box yang telah diajukan dan statusnya.</p>
        </div>
        <div className="relative">
            <input 
              type="text" 
              placeholder="Cari nomor kotak / divisi..." 
              className="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#1594a2] w-64"
            />
            <Search className="absolute left-3 top-2.5 text-gray-400" size={18} />
        </div>
      </div>

      <div className="bg-white rounded-lg shadow-sm overflow-hidden border border-gray-200">
        <div className="overflow-x-auto">
          <table className="w-full text-left">
            <thead className="bg-gray-50 border-b border-gray-200 text-gray-500 font-semibold uppercase text-xs tracking-wider">
              <tr>
                <th className="px-6 py-4">Status ACC</th>
                <th className="px-6 py-4">Nomor Kotak / RFID</th>
                <th className="px-6 py-4">Divisi & Asal</th>
                <th className="px-6 py-4">Isi Dokumen</th>
                <th className="px-6 py-4 text-center">Jml Bantex</th>
                {userRole === 'admin' && <th className="px-6 py-4 text-center">Aksi Admin</th>}
              </tr>
            </thead>
            <tbody className="bg-white divide-y divide-gray-200 text-sm">
              {boxes.map((box) => (
                <tr key={box.id} className="hover:bg-blue-50 transition-colors group">
                  <td className="px-6 py-4">
                    <span className={`inline-flex items-center px-3 py-1 rounded-full text-xs font-bold
                      ${box.status === 'approved' ? 'bg-[#b6d250] text-white' : 
                        box.status === 'rejected' ? 'bg-red-100 text-red-800' : 'bg-yellow-100 text-yellow-800'}`}>
                      {box.status === 'approved' ? 'APPROVED' : box.status === 'rejected' ? 'REJECTED' : 'PENDING'}
                    </span>
                  </td>
                  <td className="px-6 py-4 font-mono">
                    {box.status === 'approved' ? (
                       <span className="font-bold text-[#0c616a] text-base border-b-2 border-[#b6d250] pb-0.5">{box.nomor_kotak}</span>
                    ) : (
                       <span className="text-gray-400 italic text-xs flex items-center gap-1">
                         <Clock size={12}/> Menunggu Admin
                       </span>
                    )}
                  </td>
                  <td className="px-6 py-4">
                    <div className="font-bold text-gray-800">{box.divisi}</div>
                    <div className="text-xs text-gray-500">{box.asal_arsip}</div>
                    <div className="text-xs text-gray-400 mt-1">{box.tanggal}</div>
                  </td>
                  <td className="px-6 py-4">
                    <div className="max-h-20 overflow-y-auto pr-2 custom-scrollbar">
                        <ul className="list-disc list-inside text-xs text-gray-600 space-y-1">
                            {box.dokumen.map((doc, idx) => (
                                <li key={idx} className="truncate" title={doc.nama}>
                                    <span className="font-medium text-gray-800">{doc.nama}</span> <span className="text-gray-400">({doc.periode})</span>
                                </li>
                            ))}
                        </ul>
                    </div>
                  </td>
                  <td className="px-6 py-4 text-center">
                    <span className={`font-bold text-lg ${box.jumlah_bantex >= 5 ? 'text-green-600' : 'text-gray-500'}`}>
                        {box.jumlah_bantex}
                    </span>
                  </td>
                  
                  {userRole === 'admin' && (
                    <td className="px-6 py-4 text-center">
                      {box.status === 'pending' ? (
                        <div className="flex justify-center gap-2">
                          <button 
                            onClick={() => handleApprove(box.id)}
                            className="flex items-center gap-1 px-3 py-1.5 bg-[#b6d250] text-white rounded shadow hover:bg-[#a3be43] transition-colors text-xs font-bold"
                            title="ACC & Input Nomor Kotak"
                          >
                            <CheckCircle size={14} /> Input No. Kotak
                          </button>
                          <button 
                            onClick={() => handleReject(box.id)}
                            className="p-1.5 bg-red-100 text-red-600 rounded hover:bg-red-200 transition-colors"
                            title="Tolak"
                          >
                            <XCircle size={16} />
                          </button>
                        </div>
                      ) : (
                        <span className="text-xs text-gray-400">Selesai</span>
                      )}
                    </td>
                  )}
                </tr>
              ))}
              {boxes.length === 0 && (
                <tr>
                  <td colSpan={6} className="px-6 py-12 text-center text-gray-400 bg-gray-50 italic">
                    Belum ada data box arsip.
                  </td>
                </tr>
              )}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );

  // --- Render Utama ---
  if (view === 'login') return <LoginScreen />;

  return (
    <div className="flex min-h-screen bg-gray-100 font-sans text-gray-800">
      <Sidebar />
      
      <div className="flex-1 flex flex-col overflow-hidden relative">
        {/* Topbar Mobile */}
        <header className="bg-white shadow-sm h-16 flex items-center justify-between px-4 md:hidden z-20">
          <button onClick={() => setIsSidebarOpen(!isSidebarOpen)} className="text-gray-600">
            <Menu size={24} />
          </button>
          <span className="font-bold text-[#0c616a]">INDOARSIP REPO</span>
          <div className="w-6"></div> 
        </header>

        {/* Main Content */}
        <main className="flex-1 overflow-x-hidden overflow-y-auto p-4 md:p-8 relative">
           {view === 'dashboard' && <DashboardView />}
           {view === 'input-box' && <InputBoxView />}
           {view === 'data-box' && <DataBoxView />}
        </main>
      </div>
    </div>
  );
}